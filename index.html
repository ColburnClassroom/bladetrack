<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BladeTrack Web App v1.37</title>
<style>
  /* ...existing styles here... */
  label.meal-calorie-percent {
    display: inline-block;
    margin-right: 15px;
    font-size: 14px;
  }
  input.meal-percent-input {
    width: 60px;
    font-size: 14px;
  }
</style>
</head>
<body>

<h2>BladeTrack Web App v1.37</h2>
<p>Track your calories, macros, rollerblading sessions, and weight loss progress.</p>

<p>Weight (lbs): <input type="number" id="weight" value="175"></p>
<p>Height: <input type="number" id="heightFt" value="5" style="width:50px;"> ft <input type="number" id="heightIn" value="10" style="width:50px;"> in</p>
<p>Gender:
  <select id="gender">
    <option value="male">Male</option>
    <option value="female">Female</option>
    <option value="nonbinary">Nonbinary</option>
  </select>
</p>
<p>Daily Calorie Goal (kcal): <input type="number" id="calorieGoal" value="1500" oninput="updateTargetCalories()"></p>
<p>Weight Loss Goal (lbs per week): <input type="number" id="weeklyLossGoal" value="2"></p>

<h4>Desired Calorie % per Meal (total should ideally be 100%)</h4>
<label class="meal-calorie-percent">
  Breakfast: <input class="meal-percent-input" type="number" id="breakfastPercent" value="25" min="0" max="100" oninput="updateTargetCalories()">%
</label>
<label class="meal-calorie-percent">
  Lunch: <input class="meal-percent-input" type="number" id="lunchPercent" value="35" min="0" max="100" oninput="updateTargetCalories()">%
</label>
<label class="meal-calorie-percent">
  Dinner: <input class="meal-percent-input" type="number" id="dinnerPercent" value="40" min="0" max="100" oninput="updateTargetCalories()">%
</label>

<div id="mealLog"></div>

<h4>Snacks (Unhealthy Choices)</h4>
<div id="snacks"></div>

<h4>Dinner</h4>
<div id="dinnerSelected"></div>

<!-- Rollerblading session tracker, weight tracking, map, etc. here as before -->

<div id="dailyTotals"></div>

<script>
  // Extend foodData with avocado and mixed green salad
  const foodData = [
    { name: "Banana Baby Food (1 container)", meal: "Breakfast", color: "green", calories: 100, protein: 1, carbs: 25, fat: 0 },
    { name: "Plain Nonfat Yogurt (1 cup)", meal: "Breakfast", color: "green", calories: 90, protein: 10, carbs: 12, fat: 0 },
    { name: "Tofu (102.5g, 1/2 pack)", meal: "Breakfast", color: "green", calories: 200, protein: 20, carbs: 4, fat: 11 },
    { name: "Whey Protein Isolate (1 scoop)", meal: "Breakfast", color: "green", calories: 110, protein: 25, carbs: 1, fat: 0 },
    { name: "Peanut Butter (1 tsp)", meal: "Breakfast", color: "green", calories: 32, protein: 1, carbs: 1, fat: 3 },
    { name: "Avocado (1 medium)", meal: "Breakfast", color: "green", calories: 234, protein: 3, carbs: 12, fat: 21 },

    { name: "Whey Protein Isolate (1 scoop)", meal: "Lunch", color: "green", calories: 110, protein: 25, carbs: 1, fat: 0 },
    { name: "Salmon (6 oz)", meal: "Lunch", color: "green", calories: 367, protein: 39, carbs: 0, fat: 22 },
    { name: "Chicken Breast (4 oz)", meal: "Lunch", color: "green", calories: 187, protein: 35, carbs: 0, fat: 4 },
    { name: "Mixed Nuts (5 each: almonds, pistachios, cashews, walnuts)", meal: "Lunch", color: "green", calories: 300, protein: 10, carbs: 10, fat: 27 },
    { name: "Avocado (1 medium)", meal: "Lunch", color: "green", calories: 234, protein: 3, carbs: 12, fat: 21 },
    { name: "Mixed Green Salad (1 cup)", meal: "Lunch", color: "green", calories: 25, protein: 2, carbs: 5, fat: 0 },

    { name: "Salmon (6 oz)", meal: "Dinner", color: "green", calories: 367, protein: 39, carbs: 0, fat: 22 },
    { name: "Chicken Breast (4 oz)", meal: "Dinner", color: "green", calories: 187, protein: 35, carbs: 0, fat: 4 },
    { name: "Mixed Nuts (5 each: almonds, pistachios, cashews, walnuts)", meal: "Dinner", color: "green", calories: 300, protein: 10, carbs: 10, fat: 27 },
    { name: "Collard Greens (1 cup)", meal: "Dinner", color: "green", calories: 70, protein: 5, carbs: 10, fat: 1 },

    // Snacks
    { name: "Potato Chips", meal: "Snack", color: "red", calories: 150, protein: 2, carbs: 15, fat: 10, note: "Bad sodium source, fried fats." },
    { name: "Gummy Worms", meal: "Snack", color: "red", calories: 140, protein: 0, carbs: 35, fat: 0, note: "Sugar high, zero nutrients." },
    { name: "Candy Bar", meal: "Snack", color: "red", calories: 220, protein: 2, carbs: 30, fat: 12, note: "Empty calories, low satiety." },
    { name: "Movie Popcorn", meal: "Snack", color: "red", calories: 120, protein: 2, carbs: 14, fat: 7, note: "Excess salt, bad for hydration." }
  ];

  const meals = ["Breakfast", "Lunch", "Snack", "Dinner"];
  const selectedFoods = { Breakfast: [], Lunch: [], Snack: [], Dinner: [] };

  // Called on page load and whenever calorieGoal or % inputs change
  function updateTargetCalories() {
    const calorieGoal = parseInt(document.getElementById("calorieGoal").value) || 0;
    const bPct = parseInt(document.getElementById("breakfastPercent").value) || 0;
    const lPct = parseInt(document.getElementById("lunchPercent").value) || 0;
    const dPct = parseInt(document.getElementById("dinnerPercent").value) || 0;
    const totalPct = bPct + lPct + dPct;
    if(totalPct === 0) {
      document.getElementById("mealLog").querySelectorAll("h4").forEach(h => h.innerText = h.innerText.split("—")[0].trim());
      return; // prevent divide by zero
    }

    // Update meal headers with target calories
    const mealTargets = {
      Breakfast: Math.round(calorieGoal * bPct / totalPct),
      Lunch: Math.round(calorieGoal * lPct / totalPct),
      Dinner: Math.round(calorieGoal * dPct / totalPct)
    };

    const mealLogDiv = document.getElementById("mealLog");
    let headers = mealLogDiv.querySelectorAll("h4");
    headers.forEach(h => {
      const mealName = h.innerText.split("—")[0].trim();
      if(mealTargets[mealName]) {
        h.innerText = `${mealName} — Target: ${mealTargets[mealName]} kcal`;
      }
    });
  }

  function renderFoods() {
    const mealLogDiv = document.getElementById("mealLog");
    mealLogDiv.innerHTML = "";

    meals.forEach(meal => {
      if (meal === "Snack") {
        renderSnacks();
        return;
      }
      const header = document.createElement("h4");
      header.innerText = meal;
      mealLogDiv.appendChild(header);

      const foodsForMeal = foodData.filter(f => f.meal === meal);
      foodsForMeal.forEach(food => {
        const btn = document.createElement("button");
        btn.className = `food-button ${food.color}`;
        btn.innerText = `${food.name} — ${food.calories} kcal`;
        btn.title = food.note ? food.note : "";
        btn.addEventListener("click", () => {
          addFoodToMeal(meal, food);
        });
        mealLogDiv.appendChild(btn);
      });

      const selectedDiv = document.createElement("div");
      selectedDiv.id = `${meal.toLowerCase()}Selected`;
      mealLogDiv.appendChild(selectedDiv);
      updateMealSummary(meal);
    });

    updateTargetCalories();
  }

  function renderSnacks() {
    const snackDiv = document.getElementById("snacks");
    snackDiv.innerHTML = ""; // cleared heading in HTML already

    const snacks = foodData.filter(f => f.meal === "Snack");
    snacks.forEach(food => {
      const btn = document.createElement("button");
      btn.className = `food-button ${food.color}`;
      btn.innerText = `${food.name} — ${food.calories} kcal`;
      btn.title = food.note ? food.note : "";
      btn.addEventListener("click", () => {
        addFoodToMeal("Snack", food);
      });
      snackDiv.appendChild(btn);
    });

    const selectedDiv = document.getElementById("snackSelected");
    if (!selectedDiv) {
      const div = document.createElement("div");
      div.id = "snackSelected";
      snackDiv.appendChild(div);
    }
    updateMealSummary("Snack");
  }

  function addFoodToMeal(meal, food) {
    selectedFoods[meal].push(food);
    updateMealSummary(meal);
    updateDailyTotals();
  }

  function updateMealSummary(meal) {
    const container = document.getElementById(`${meal.toLowerCase()}Selected`);
    if (!container) return;
    container.innerHTML = "";

    if (selectedFoods[meal].length === 0) {
      container.innerText = "No foods selected yet.";
      return;
    }

    let totalCalories = 0, totalProtein = 0, totalCarbs = 0, totalFat = 0;
    selectedFoods[meal].forEach(food => {
      totalCalories += food.calories;
      totalProtein += food.protein;
      totalCarbs += food.carbs;
      totalFat += food.fat;
      const p = document.createElement("p");
      p.className = "selected-food";
      p.innerText = `${food.name} — ${food.calories} kcal`;
      container.appendChild(p);
    });

    const caloriesFromProtein = totalProtein * 4;
    const caloriesFromCarbs = totalCarbs * 4;
    const caloriesFromFat = totalFat * 9;
    const totalMacroCalories = caloriesFromProtein + caloriesFromCarbs + caloriesFromFat;

    let pctProtein = 0, pctCarbs = 0, pctFat = 0;
    if(totalMacroCalories > 0) {
      pctProtein = ((caloriesFromProtein / totalMacroCalories) * 100).toFixed(1);
      pctCarbs = ((caloriesFromCarbs / totalMacroCalories) * 100).toFixed(1);
      pctFat = ((caloriesFromFat / totalMacroCalories) * 100).toFixed(1);
    }

    const summary = document.createElement("p");
    summary.style.fontWeight = "bold";
    summary.innerText = `Total: ${totalCalories} kcal — Protein: ${pctProtein}%, Carbs: ${pctCarbs}%, Fat: ${pctFat}%`;
    container.appendChild(summary);
  }

  function updateDailyTotals() {
    const dailyDiv = document.getElementById("dailyTotals");
    let totalCalories = 0, totalProtein = 0, totalCarbs = 0, totalFat = 0;
    meals.forEach(meal => {
      selectedFoods[meal].forEach(food => {
        totalCalories += food.calories;
        totalProtein += food.protein;
        totalCarbs += food.carbs;
        totalFat += food.fat;
      });
    });

    const caloriesFromProtein = totalProtein * 4;
    const caloriesFromCarbs = totalCarbs * 4;
    const caloriesFromFat = totalFat * 9;
    const totalMacroCalories = caloriesFromProtein + caloriesFromCarbs + caloriesFromFat;

    let pctProtein = 0, pctCarbs = 0, pctFat = 0;
    if(totalMacroCalories > 0) {
      pctProtein = ((caloriesFromProtein / totalMacroCalories) * 100).toFixed(1);
      pctCarbs = ((caloriesFromCarbs / totalMacroCalories) * 100).toFixed(1);
      pctFat = ((caloriesFromFat / totalMacroCalories) * 100).toFixed(1);
    }

    dailyDiv.innerHTML = `Daily Total: ${totalCalories} kcal — Protein: ${pctProtein}%, Carbs: ${pctCarbs}%, Fat: ${pctFat}%`;
  }

  // Other functions as before for rollerblading, weight, map...

  document.addEventListener("DOMContentLoaded", () => {
    renderFoods();
    updateTargetCalories();
    // initMap() call if you have Google Maps API key set up
  });
</script>
<!-- Include Google Maps API script here as before -->
</body>
</html>
