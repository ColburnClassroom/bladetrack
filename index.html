<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BladeTrack Web App v1.49</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    button, input, label, select { margin: 10px 0; padding: 12px; font-size: 16px; }
    h4 { font-size: 20px; margin-top: 20px; }
    .hot-warning { color: orange; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; text-align: center; }
    th { background-color: #f9f9f9; }
    #map { height: 300px; margin: 20px 0; }
    .food-button { display: block; width: 100%; margin: 5px 0; padding: 10px; font-size: 14px; border-radius: 5px; border: none; text-align: left; cursor: pointer; }
    .green { background-color: #e0f7e9; border-left: 5px solid green; }
    .yellow { background-color: #fff9e6; border-left: 5px solid orange; }
    .red { background-color: #fdecea; border-left: 5px solid red; }
    .selected { font-weight: bold; opacity: 0.8; }
  </style>
</head>
<body>

<h2>BladeTrack Web App v1.49</h2>
<p>Track your calories, macros, rollerblading sessions, and weight loss progress.</p>

<p>Weight (lbs): <input type="number" id="weight" value="175"></p>
<p>Height: <input type="number" id="heightFt" value="5"> ft <input type="number" id="heightIn" value="10"> in</p>
<p>Gender:
  <select id="gender">
    <option value="male">Male</option>
    <option value="female">Female</option>
    <option value="nonbinary">Nonbinary</option>
  </select>
</p>
<p>Daily Calorie Goal: <input type="number" id="calorieGoal" value="1500"> calories</p>
<p>Weight Loss Goal (lbs per week): <input type="number" id="weeklyLossGoal" value="2"></p>

<p>Target Calorie Distribution: 
  Breakfast <input type="number" id="pctBreakfast" value="25" style="width:60px">% 
  Lunch <input type="number" id="pctLunch" value="40" style="width:60px">% 
  Snacks <input type="number" id="pctSnacks" value="10" style="width:60px">% 
  Dinner <input type="number" id="pctDinner" value="25" style="width:60px">%
</p>

<h3>Meal Tracking</h3>
<div id="mealLog"></div>
<div id="foodSummary"></div>
<div id="mealTotals"></div>

<h3>Daily Calorie and Macro Totals</h3>
<div id="dayTotals"></div>

<h3>Rollerblading Session Tracker</h3>
<p>Start time: <input type="time" id="bladeStart"> End time: <input type="time" id="bladeEnd"> Distance (miles): <input type="number" id="bladeMiles" step="0.1"></p>
<button onclick="calculateBladeCalories()">Calculate Blade Calories</button>
<div id="bladeResult"></div>
<div id="weather"></div>
<div id="warning" class="hot-warning"></div>

<h3>Weight Tracking & Progress</h3>
<p>Log Today's Weight (lbs): <input type="number" id="dailyWeight"><button onclick="logWeight()">Log Weight</button></p>
<canvas id="weight-progress-chart" width="600" height="200"></canvas>
<div id="weightLog"></div>

<h3>Food Log Summary</h3>
<div id="foodLog"></div>

<h3>Macro Diet Benchmarks</h3>
<table>
<tr><th>Diet Type</th><th>Protein %</th><th>Carb %</th><th>Fat %</th></tr>
<tr><td>Balanced</td><td>30%</td><td>40%</td><td>30%</td></tr>
<tr><td>High-Protein, Low-Carb (Weight Loss, High Energy, High Satiety)</td><td>40%</td><td>25%</td><td>35%</td></tr>
<tr><td>High-Carb (Vegan, Endurance)</td><td>15%</td><td>60%</td><td>25%</td></tr>
<tr><td>High-Fat (Keto)</td><td>20%</td><td>10%</td><td>70%</td></tr>
</table>

<h3>Electrolyte Comparison</h3>
<table>
<tr><th>Product</th><th>Sodium (mg)</th><th>Potassium (mg)</th><th>Magnesium (mg)</th><th>Notes</th></tr>
<tr><td>LMNT</td><td>1000</td><td>200</td><td>60</td><td>Excellent balance</td></tr>
<tr><td>Pickle Shot</td><td>900</td><td>0</td><td>0</td><td>High sodium only</td></tr>
<tr><td>VenturePal</td><td>100</td><td>50</td><td>20</td><td>Weak overall</td></tr>
<tr><td>SmartWater</td><td>10</td><td>2</td><td>1</td><td>Practically negligible</td></tr>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function initMap() {
  // Empty function to prevent Google Maps script error
}

let bladeCalories = 0;

// Food data with macros and calories
const foods = {
  breakfast: [
    {name:"Banana Baby Food", cal:100, protein:1, carbs:25, fat:0, color:"green", benefit:"Potassium rich, good for electrolytes."},
    {name:"Tofu (102.5g)", cal:200, protein:20, carbs:4, fat:12, color:"green", benefit:"High protein, plant-based."},
    {name:"Plain Nonfat Yogurt (1 cup)", cal:150, protein:12, carbs:17, fat:0, color:"green", benefit:"Good source of protein and calcium."},
    {name:"Whey Protein Isolate (1 scoop)", cal:110, protein:25, carbs:2, fat:1, color:"green", benefit:"High protein, low carb."},
    {name:"Peanut Butter (1 tsp, smooth unsalted)", cal:32, protein:1, carbs:1, fat:3, color:"green", benefit:"Healthy fats and protein."},
    {name:"Mixed Nuts (5 pistachios, 5 almonds, 5 cashews, 5 walnuts)", cal:230, protein:6, carbs:8, fat:20, color:"green", benefit:"Healthy fats and fiber."},
    {name:"Avocado (small)", cal:220, protein:3, carbs:12, fat:20, color:"green", benefit:"Healthy fats and fiber, satiating."}
  ],
  lunch: [
    {name:"Salmon (6 oz)", cal:350, protein:40, carbs:0, fat:20, color:"green", benefit:"Rich in omega-3 fatty acids, satiating."},
    {name:"Chicken Breast (6 oz)", cal:280, protein:52, carbs:0, fat:6, color:"green", benefit:"High protein, lean meat."},
    {name:"Mixed Green Salad (1 cup)", cal:30, protein:2, carbs:6, fat:0, color:"green", benefit:"Low calorie, rich in fiber and micronutrients."},
    {name:"Whey Protein Isolate (1 scoop)", cal:110, protein:25, carbs:2, fat:1, color:"green", benefit:"High protein, low carb."},
    {name:"Mixed Nuts (5 pistachios, 5 almonds, 5 cashews, 5 walnuts)", cal:230, protein:6, carbs:8, fat:20, color:"green", benefit:"Healthy fats and fiber."},
    {name:"Avocado (small)", cal:220, protein:3, carbs:12, fat:20, color:"green", benefit:"Healthy fats and fiber, satiating."}
  ],
  snacks: [
    {name:"Potato Chips (1 bag)", cal:150, protein:2, carbs:15, fat:10, color:"red", warning:"Potato chips are high in unhealthy fats and provide little nutritional benefit. Not a good sodium source for electrolyte balance."},
    {name:"Popcorn (1 bag)", cal:120, protein:2, carbs:20, fat:5, color:"red", warning:"Popcorn offers little sodium and is mostly empty calories."},
    {name:"Gummy Worms (1 serving)", cal:130, protein:0, carbs:30, fat:0, color:"red", warning:"Gummy worms cause sugar spikes and lack filling nutrients."},
    {name:"Candy Bar (1 bar)", cal:210, protein:2, carbs:28, fat:10, color:"red", warning:"Candy bars cause sugar highs but arenâ€™t filling and add empty calories."}
  ],
  dinner: [
    {name:"Salmon (6 oz)", cal:350, protein:40, carbs:0, fat:20, color:"green", benefit:"Rich in omega-3 fatty acids, satiating."},
    {name:"Chicken Breast (6 oz)", cal:280, protein:52, carbs:0, fat:6, color:"green", benefit:"High protein, lean meat."},
    {name:"Mixed Nuts (5 pistachios, 5 almonds, 5 cashews, 5 walnuts)", cal:230, protein:6, carbs:8, fat:20, color:"green", benefit:"Healthy fats and fiber."},
    {name:"Avocado (small)", cal:220, protein:3, carbs:12, fat:20, color:"green", benefit:"Healthy fats and fiber, satiating."}
  ]
};

const mealKeys = ["breakfast", "lunch", "snacks", "dinner"];

// Store selected foods per meal
let selectedFoods = {
  breakfast: new Set(),
  lunch: new Set(),
  snacks: new Set(),
  dinner: new Set()
};

// Render food buttons for each meal
function renderFoodButtons() {
  const mealLog = document.getElementById("mealLog");
  mealLog.innerHTML = "";
  mealKeys.forEach(meal => {
    const mealSection = document.createElement("div");
    mealSection.innerHTML = `<h4>${capitalize(meal)}</h4>`;
    foods[meal].forEach((food, idx) => {
      const btn = document.createElement("button");
      btn.className = `food-button ${food.color}`;
      btn.textContent = `${food.name} (${food.cal} cal) - ${food.benefit || food.warning || ""}`;
      btn.onclick = () => toggleFoodSelection(meal, idx, btn);
      mealSection.appendChild(btn);
    });
    mealLog.appendChild(mealSection);
  });
}

// Toggle food selection
function toggleFoodSelection(meal, idx, btn) {
  const foodName = foods[meal][idx].name;
  if (selectedFoods[meal].has(foodName)) {
    selectedFoods[meal].delete(foodName);
    btn.classList.remove("selected");
  } else {
    selectedFoods[meal].add(foodName);
    btn.classList.add("selected");
  }
  updateFoodSummary();
  updateTotals();
}

// Calculate total calories and macros for selected foods
function calculateTotals() {
  let totalCalories = 0;
  let totalProtein = 0;
  let totalCarbs = 0;
  let totalFat = 0;
  
  mealKeys.forEach(meal => {
    selectedFoods[meal].forEach(foodName => {
      const food = foods[meal].find(f => f.name === foodName);
      if (food) {
        totalCalories += food.cal;
        totalProtein += food.protein;
        totalCarbs += food.carbs;
        totalFat += food.fat;
      }
    });
  });

  return {totalCalories, totalProtein, totalCarbs, totalFat};
}

// Update food summary and per meal calories/macros
function updateFoodSummary() {
  const foodSummary = document.getElementById("foodSummary");
  let html = "";
  mealKeys.forEach(meal => {
    if (selectedFoods[meal].size > 0) {
      html += `<h4>${capitalize(meal)} Selected Foods:</h4><ul>`;
      selectedFoods[meal].forEach(foodName => {
        const food = foods[meal].find(f => f.name === foodName);
        if (food) {
          html += `<li>${food.name} - ${food.cal} cal</li>`;
          if(food.color === "red" && food.warning) {
            html += `<p style="color:red; font-style: italic;">Warning: ${food.warning}</p>`;
          } else if(food.benefit) {
            html += `<p style="color:green; font-style: italic;">Benefit: ${food.benefit}</p>`;
          }
        }
      });
      html += "</ul>";
    }
  });
  foodSummary.innerHTML = html;
}

// Update per meal totals (calories & macros)
function updateMealTotals() {
  const mealTotals = document.getElementById("mealTotals");
  let html = "<h4>Meal Totals:</h4>";
  mealKeys.forEach(meal => {
    let mealCal = 0, mealP = 0, mealC = 0, mealF = 0;
    selectedFoods[meal].forEach(foodName => {
      const food = foods[meal].find(f => f.name === foodName);
      if (food) {
        mealCal += food.cal;
        mealP += food.protein;
        mealC += food.carbs;
        mealF += food.fat;
      }
    });
    if (mealCal > 0) {
      // Macronutrient percentages for this meal:
      const totalMacro = mealP + mealC + mealF;
      const pPct = totalMacro ? ((mealP / totalMacro) * 100).toFixed(1) : 0;
      const cPct = totalMacro ? ((mealC / totalMacro) * 100).toFixed(1) : 0;
      const fPct = totalMacro ? ((mealF / totalMacro) * 100).toFixed(1) : 0;
      html += `<p><strong>${capitalize(meal)}:</strong> ${mealCal} cal (Protein: ${pPct}%, Carbs: ${cPct}%, Fat: ${fPct}%)</p>`;
    }
  });
  mealTotals.innerHTML = html;
}

// Calculate and update daily totals and adjusted calorie goals
function updateTotals() {
  const calorieGoal = parseFloat(document.getElementById("calorieGoal").value) || 1500;
  const caloriesBurned = bladeCalories || 0;

  // Calculate calories consumed from selected foods
  const {totalCalories, totalProtein, totalCarbs, totalFat} = calculateTotals();

  const netCalories = totalCalories - caloriesBurned;
  const adjustedGoal = calorieGoal + caloriesBurned;

  // Macro percentages for total macros consumed
  const totalMacro = totalProtein + totalCarbs + totalFat;
  const pPct = totalMacro ? ((totalProtein / totalMacro) * 100).toFixed(1) : 0;
  const cPct = totalMacro ? ((totalCarbs / totalMacro) * 100).toFixed(1) : 0;
  const fPct = totalMacro ? ((totalFat / totalMacro) * 100).toFixed(1) : 0;

  const dayTotals = document.getElementById("dayTotals");
  dayTotals.innerHTML = `
    <p><strong>Total Calories Consumed:</strong> ${totalCalories.toFixed(0)} kcal</p>
    <p><strong>Calories Burned (Rollerblading):</strong> ${caloriesBurned.toFixed(0)} kcal</p>
    <p><strong>Net Calories (Consumed - Burned):</strong> ${netCalories.toFixed(0)} kcal</p>
    <p><strong>Adjusted Calorie Goal (Original + Burned):</strong> ${adjustedGoal.toFixed(0)} kcal</p>
    <p><strong>Daily Macronutrient Percentages:</strong> Protein ${pPct}%, Carbs ${cPct}%, Fat ${fPct}%</p>
  `;

  updateMealTotals();
}

// Rollerblading calorie calculation
function calculateBladeCalories() {
  const weight = parseFloat(document.getElementById("weight").value) || 175;
  const miles = parseFloat(document.getElementById("bladeMiles").value) || 0;
  const start = document.getElementById("bladeStart").value;
  const end = document.getElementById("bladeEnd").value;
  let duration = 0;
  if (start && end) {
    const [sh, sm] = start.split(":").map(Number);
    const [eh, em] = end.split(":").map(Number);
    duration = ((eh * 60 + em) - (sh * 60 + sm)) / 60;
    if (duration < 0) duration = 0;
  }
  const met = 7.0;
  const weightKg = weight * 0.453592;
  const hours = duration || (miles / 9);
  bladeCalories = met * weightKg * hours * 0.25; // modest quarter MET factor as requested
  document.getElementById("bladeResult").innerText = `Estimated Calories Burned: ${Math.round(bladeCalories)} kcal over ${hours.toFixed(2)} hours.`;
  updateTotals();
}

// Capitalize helper
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

// NYC weather and electrolyte guidance
const temperatureF = 89;
const humidity = 65;
document.getElementById("weather").innerText = `Union Square, NYC: ${temperatureF}Â°F â€” ${humidity}% humidity.`;
if (temperatureF > 86) {
  document.getElementById("warning").innerText = "ðŸ”¥ It's hot! Rehydrate with LMNT or potassium-rich foods (like bananas). Avoid SmartWaterâ€”too low in electrolytes. Gatorade, Propel, and VenturePal also underdeliver unless heavily sweating.";
}

// Weight tracking (chart code omitted here for brevity, unchanged)

function logWeight() {
  const val = parseFloat(document.getElementById("dailyWeight").value);
  if (!val) return;
  const entries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
  const date = new Date().toLocaleDateString();
  entries.push({ date, weight: val });
  localStorage.setItem("weightEntries", JSON.stringify(entries));
  location.reload();
}

// Initialize
renderFoodButtons();
updateTotals();
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNyTZL3SySu9n5tkcyc9fiU34d2iviE9E&callback=initMap" async defer></script>

</body>
</html>
