<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BladeTrack Web App</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    button, input, label, select { display: block; width: 100%; margin: 10px 0; padding: 12px; font-size: 16px; }
    .hot-warning { color: orange; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; text-align: center; }
    th { background-color: #f9f9f9; }
    .checkboxes { margin: 10px 0; }
    .checkboxes label { display: block; font-size: 16px; }
    #map { height: 300px; margin: 20px 0; }
  </style>
</head>
<body>

<h2>BladeTrack Web App</h2>
<p>Track your calories, macros, and rollerblading sessions.</p>

<p>Your weight (lbs): <input type="number" id="weight" value="150"></p>
<button onclick="startSession()">Start Rollerblading</button>
<button onclick="stopSession()">Stop</button>
<div id="weather"></div>
<div id="warning" class="hot-warning"></div>
<div class="checkboxes" id="checklist" style="display:none;">
  <label><input type="checkbox" id="drankWater"> Drank water</label>
  <label><input type="checkbox" id="ateBanana"> Ate banana</label>
  <label><input type="checkbox" id="ateSaltyFood"> Ate salty food</label>
  <button onclick="saveChecklist()">‚úîÔ∏è Save Session</button>
</div>
<div id="result"></div>
<div id="map"></div>

<h3>Food Log</h3>
<div id="foodLog"></div>

<script>
const MET_ROLLERBLADING = 7.0;
let startTime = null;

// Hardcoded Union Square summer conditions
const temperatureF = 89.6;
const humidity = 70;
document.getElementById("weather").innerText = `Union Square: ${temperatureF}¬∞F ‚Äî ${humidity}% humidity`;
if (temperatureF > 86) {
  document.getElementById("warning").innerText = "üî• It‚Äôs hot! Drink water and eat potassium-rich foods like bananas.";
}

function startSession() {
  const weightInput = document.getElementById("weight").value;
  if (!weightInput || isNaN(weightInput) || weightInput <= 0) {
    alert("Enter your weight in pounds.");
    return;
  }
  startTime = Date.now();
  document.getElementById("result").innerText = "Session started...";
}

function stopSession() {
  if (!startTime) return;
  const durationMin = (Date.now() - startTime) / 60000;
  const weightLbs = parseFloat(document.getElementById("weight").value);
  const weightKg = weightLbs * 0.4536;
  const tempMod = temperatureF > 86 ? 1.15 : 1;
  const kcal = MET_ROLLERBLADING * weightKg * (durationMin / 60) * tempMod;
  const date = new Date().toLocaleString();
  const entry = {
    date, duration: durationMin.toFixed(1), calories: Math.round(kcal), temperature: temperatureF,
    water: false, banana: false, salty: false
  };
  localStorage.setItem("current_session", JSON.stringify(entry));
  document.getElementById("checklist").style.display = "block";
  document.getElementById("result").innerText = `Duration: ${entry.duration} minutes\nCalories burned: ${entry.calories}`;
  startTime = null;
}

function saveChecklist() {
  let entry = JSON.parse(localStorage.getItem("current_session"));
  if (!entry) return;
  entry.water = document.getElementById("drankWater").checked;
  entry.banana = document.getElementById("ateBanana").checked;
  entry.salty = document.getElementById("ateSaltyFood").checked;
  let log = JSON.parse(localStorage.getItem("blade_sessions") || "[]");
  log.unshift(entry);
  localStorage.setItem("blade_sessions", JSON.stringify(log));
  localStorage.removeItem("current_session");
  document.getElementById("checklist").style.display = "none";
}

const foodDB = [
  { name: "Plain Nonfat Yogurt (6 oz)", calories: 90, protein: 9, carbs: 12, fat: 0, meal: "breakfast" },
  { name: "Banana Baby Food (1 container)", calories: 100, protein: 1, carbs: 22, fat: 0, meal: "breakfast" },
  { name: "Peanut Butter, Unsalted (1 tsp)", calories: 32, protein: 1.5, carbs: 1, fat: 3, meal: "breakfast" },
  { name: "Tofu (102.5g / half pack)", calories: 200, protein: 20, carbs: 4, fat: 12, meal: "lunch" },
  { name: "Salmon (6 oz)", calories: 350, protein: 34, carbs: 0, fat: 22, meal: "lunch" },
  { name: "Mixed Greens Salad (1 bowl)", calories: 35, protein: 2, carbs: 5, fat: 0, meal: "lunch" },
  { name: "Whey Protein Isolate (1 scoop)", calories: 110, protein: 25, carbs: 1, fat: 0.5, meal: "dinner" },
  { name: "Chips (1 small bag)", calories: 150, protein: 2, carbs: 15, fat: 10, meal: "dinner", guilt: "Really? This is what we're doing?" },
  { name: "Movie Theater Popcorn (2 cups)", calories: 200, protein: 3, carbs: 18, fat: 15, meal: "dinner", guilt: "Sure, go ahead. Undo your whole workout." }
];

function updateFoodLog() {
  const log = JSON.parse(localStorage.getItem("food_log") || "[]");
  let total = 0, totalProtein = 0, totalCarbs = 0, totalFat = 0;
  log.forEach(item => {
    const dbItem = foodDB.find(f => f.name === item.name);
    total += item.calories;
    if (dbItem) {
      totalProtein += dbItem.protein || 0;
      totalCarbs += dbItem.carbs || 0;
      totalFat += dbItem.fat || 0;
    }
  });
  const macroTotal = totalProtein * 4 + totalCarbs * 4 + totalFat * 9;
  const proteinPct = ((totalProtein * 4) / macroTotal * 100).toFixed(1);
  const carbsPct = ((totalCarbs * 4) / macroTotal * 100).toFixed(1);
  const fatPct = ((totalFat * 9) / macroTotal * 100).toFixed(1);

  const summary = document.createElement("div");
  summary.innerHTML = `
    <p>Total food calories today: ${total} kcal</p>
    <p>Macronutrient breakdown:</p>
    <ul>
      <li>Protein: ${totalProtein}g (${proteinPct}%)</li>
      <li>Carbs: ${totalCarbs}g (${carbsPct}%)</li>
      <li>Fat: ${totalFat}g (${fatPct}%)</li>
    </ul>`;
  document.getElementById("foodLog").innerHTML = "";
  document.getElementById("foodLog").appendChild(summary);
}

updateFoodLog();
</script>
</body>
</html>
