<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BladeTrack Web App v1.46</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    button, input, label, select { margin: 10px 0; padding: 12px; font-size: 16px; }
    h3 { margin-top: 30px; }
    h4 { font-size: 20px; margin-top: 20px; }
    .hot-warning { color: orange; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; text-align: center; }
    th { background-color: #f9f9f9; }
    #map { height: 300px; margin: 20px 0; }
    .food-button { display: block; width: 100%; margin: 5px 0; padding: 10px; font-size: 14px; border-radius: 5px; border: none; text-align: left; cursor: pointer; }
    .green { background-color: #e0f7e9; border-left: 5px solid green; }
    .yellow { background-color: #fff9e6; border-left: 5px solid orange; }
    .red { background-color: #fdecea; border-left: 5px solid red; }
    .selected { font-weight: bold; opacity: 0.8; }
  </style>
</head>
<body>

<h2>BladeTrack Web App v1.46</h2>
<p>Track your calories, macros, rollerblading sessions, and weight loss progress.</p>

<p>Weight (lbs): <input type="number" id="weight" value="175" /></p>
<p>Height: <input type="number" id="heightFt" value="5" style="width:50px" /> ft 
   <input type="number" id="heightIn" value="10" style="width:50px" /> in</p>
<p>Gender:
  <select id="gender">
    <option value="male">Male</option>
    <option value="female">Female</option>
    <option value="nonbinary">Nonbinary</option>
  </select>
</p>
<p>Daily Calorie Goal (kcal): <input type="number" id="calorieGoal" value="1500" /></p>
<p>Weight Loss Goal (lbs per week): <input type="number" id="weeklyLossGoal" value="2" /></p>

<p>Target Calorie Distribution: 
  Breakfast <input type="number" id="pctBreakfast" value="25" style="width:60px" />% 
  Lunch <input type="number" id="pctLunch" value="40" style="width:60px" />% 
  Snacks <input type="number" id="pctSnacks" value="10" style="width:60px" />% 
  Dinner <input type="number" id="pctDinner" value="25" style="width:60px" />%
</p>

<h3>Meal Tracking</h3>

<div id="mealSections"></div>

<h3>Rollerblading Session Tracker</h3>
<p>Start time: <input type="time" id="bladeStart" /> 
   End time: <input type="time" id="bladeEnd" /> 
   Distance (miles): <input type="number" id="bladeMiles" step="0.1" />
</p>
<button onclick="calculateBladeCalories()">Calculate Blade Calories</button>
<div id="bladeResult"></div>
<div id="weather"></div>
<div id="warning" class="hot-warning"></div>

<h3>Weight Tracking & Progress</h3>
<p>Log Today's Weight (lbs): <input type="number" id="dailyWeight" />
<button onclick="logWeight()">Log Weight</button></p>
<canvas id="weight-progress-chart" width="600" height="200"></canvas>
<div id="weightLog"></div>

<h3>Food Log Summary</h3>
<div id="foodSummary"></div>

<div id="day-totals"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Food data with macros and calories
  const foods = {
    breakfast: [
      { name: "Banana baby food (1 container)", calories: 100, protein: 1, carbs: 23, fat: 0, color: "green", benefit: "Potassium rich, good for electrolytes." },
      { name: "Peanut butter (1 tsp, smooth, unsalted)", calories: 32, protein: 1.3, carbs: 1, fat: 2.7, color: "green", benefit: "Healthy fats and protein." },
      { name: "Tofu (102.5g, half package)", calories: 200, protein: 20, carbs: 2, fat: 12, color: "green", benefit: "Good plant-based protein." },
      { name: "Plain nonfat yogurt (1 cup)", calories: 150, protein: 13, carbs: 17, fat: 0, color: "green", benefit: "Calcium and protein." },
      { name: "Whey protein isolate (1 scoop)", calories: 110, protein: 25, carbs: 1, fat: 0, color: "green", benefit: "High protein, low carb." },
      { name: "Mixed nuts (5 pistachios, 5 almonds, 5 cashews, 5 walnuts)", calories: 200, protein: 5, carbs: 6, fat: 18, color: "green", benefit: "Good fats and protein." },
      { name: "Avocado (1/2 medium)", calories: 120, protein: 1.5, carbs: 6, fat: 10, color: "green", benefit: "Healthy fats and fiber." }
    ],
    lunch: [
      { name: "Salmon (6 oz)", calories: 367, protein: 39, carbs: 0, fat: 22, color: "green", benefit: "Omega-3 rich, filling." },
      { name: "Chicken breast (6 oz)", calories: 276, protein: 52, carbs: 0, fat: 6, color: "green", benefit: "Lean protein." },
      { name: "Mixed green salad (1 cup)", calories: 25, protein: 2, carbs: 4, fat: 0, color: "green", benefit: "Low calorie, fiber." },
      { name: "Whey protein isolate (1 scoop)", calories: 110, protein: 25, carbs: 1, fat: 0, color: "green", benefit: "High protein, low carb." },
      { name: "Avocado (1/2 medium)", calories: 120, protein: 1.5, carbs: 6, fat: 10, color: "green", benefit: "Healthy fats and fiber." },
      { name: "Mixed nuts (5 pistachios, 5 almonds, 5 cashews, 5 walnuts)", calories: 200, protein: 5, carbs: 6, fat: 18, color: "green", benefit: "Good fats and protein." }
    ],
    snacks: [
      { name: "Potato chips (1 bag)", calories: 150, protein: 2, carbs: 15, fat: 10, color: "red", warning: "Potato chips are not a good source of sodium and have unhealthy fats." },
      { name: "Popcorn (1 bag)", calories: 120, protein: 2, carbs: 22, fat: 3, color: "red", warning: "Popcorn and potato chips lack sufficient electrolytes for rehydration." },
      { name: "Gummy worms (1 pack)", calories: 150, protein: 0, carbs: 38, fat: 0, color: "red", warning: "Gummy worms give a sugar high but are not filling or nutritious." },
      { name: "Candy bars (1 bar)", calories: 210, protein: 2, carbs: 30, fat: 10, color: "red", warning: "Candy bars provide quick sugar energy but no lasting fullness." }
    ],
    dinner: [
      { name: "Salmon (6 oz)", calories: 367, protein: 39, carbs: 0, fat: 22, color: "green", benefit: "Omega-3 rich, filling." },
      { name: "Chicken breast (6 oz)", calories: 276, protein: 52, carbs: 0, fat: 6, color: "green", benefit: "Lean protein." },
      { name: "Mixed nuts (5 pistachios, 5 almonds, 5 cashews, 5 walnuts)", calories: 200, protein: 5, carbs: 6, fat: 18, color: "green", benefit: "Good fats and protein." },
      { name: "Mixed green salad (1 cup)", calories: 25, protein: 2, carbs: 4, fat: 0, color: "green", benefit: "Low calorie, fiber." },
      { name: "Avocado (1/2 medium)", calories: 120, protein: 1.5, carbs: 6, fat: 10, color: "green", benefit: "Healthy fats and fiber." }
    ]
  };

  // State of selected food items by meal
  const mealSelections = {
    breakfast: new Set(),
    lunch: new Set(),
    snacks: new Set(),
    dinner: new Set()
  };

  // Render meal buttons and selected foods
  function renderMealSections() {
    const container = document.getElementById("mealSections");
    container.innerHTML = "";

    ["breakfast", "lunch", "snacks", "dinner"].forEach(meal => {
      const section = document.createElement("div");
      section.innerHTML = `<h4>${meal.charAt(0).toUpperCase() + meal.slice(1)}</h4>`;

      foods[meal].forEach((food, idx) => {
        const btn = document.createElement("button");
        btn.className = `food-button ${food.color}`;
        btn.textContent = `${food.name} (${food.calories} kcal)`;
        btn.title = food.benefit || food.warning || "";
        btn.onclick = () => toggleFoodSelection(meal, idx, btn);
        section.appendChild(btn);
      });

      // Selected foods log
      const selectedDiv = document.createElement("div");
      selectedDiv.id = `${meal}Selected`;
      selectedDiv.style.marginTop = "10px";
      section.appendChild(selectedDiv);

      container.appendChild(section);
    });
  }

  function toggleFoodSelection(meal, idx, button) {
    if(mealSelections[meal].has(idx)){
      mealSelections[meal].delete(idx);
      button.classList.remove("selected");
    } else {
      mealSelections[meal].add(idx);
      button.classList.add("selected");
    }
    updateMealLog(meal);
    updateTotals();
  }

  function updateMealLog(meal) {
    const div = document.getElementById(meal + "Selected");
    const selectedIndexes = Array.from(mealSelections[meal]);
    if(selectedIndexes.length === 0){
      div.textContent = "No items selected.";
      return;
    }
    let totalCalories = 0, totalProtein=0, totalCarbs=0, totalFat=0;
    const list = document.createElement("ul");
    selectedIndexes.forEach(i => {
      const food = foods[meal][i];
      totalCalories += food.calories;
      totalProtein += food.protein;
      totalCarbs += food.carbs;
      totalFat += food.fat;
      const li = document.createElement("li");
      li.textContent = `${food.name} - ${food.calories} kcal`;
      list.appendChild(li);
    });
    div.innerHTML = "";
    div.appendChild(list);
    const macrosText = `Total: ${totalCalories} kcal | Protein: ${totalProtein}g | Carbs: ${totalCarbs}g | Fat: ${totalFat}g`;
    div.appendChild(document.createElement("br"));
    div.appendChild(document.createTextNode(macrosText));
  }

  // Rollerblading calories calculation (modest estimate: 25% of MET calculation)
  let bladeCalories = 0;
  function calculateBladeCalories() {
    const weight = parseFloat(document.getElementById("weight").value) || 175;
    const miles = parseFloat(document.getElementById("bladeMiles").value) || 0;
    const start = document.getElementById("bladeStart").value;
    const end = document.getElementById("bladeEnd").value;
    let duration = 0;
    if (start && end) {
      const [sh, sm] = start.split(":");
      const [eh, em] = end.split(":");
      duration = ((parseInt(eh)*60+parseInt(em)) - (parseInt(sh)*60+parseInt(sm))) / 60;
      if(duration < 0) duration = 0;
    }
    const met = 7.0;
    const weightKg = weight * 0.453592;
    const hours = duration || (miles / 9);
    bladeCalories = met * weightKg * hours * 0.25;  // 25% of usual estimate
    document.getElementById("bladeResult").innerText = `Estimated Calories Burned: ${Math.round(bladeCalories)} kcal over ${hours.toFixed(2)} hours.`;
    updateTotals();
  }

  // Update day totals and macros, including adjusted calorie goals
  function updateTotals() {
    let dayCalories = 0, dayProtein = 0, dayCarbs = 0, dayFat = 0;
    for(let meal in mealSelections){
      mealSelections[meal].forEach(i => {
        const f = foods[meal][i];
        dayCalories += f.calories;
        dayProtein += f.protein;
        dayCarbs += f.carbs;
        dayFat += f.fat;
      });
    }
    const baseGoal = parseFloat(document.getElementById("calorieGoal").value) || 1500;
    const adjustedGoal = Math.round(baseGoal + bladeCalories);
    let netCalories = Math.round(dayCalories - bladeCalories);
    if(netCalories < 0) netCalories = 0;

    const totalMacros = dayProtein*4 + dayCarbs*4 + dayFat*9;
    const proteinPct = totalMacros ? ((dayProtein*4)/totalMacros*100).toFixed(1) : 0;
    const carbsPct = totalMacros ? ((dayCarbs*4)/totalMacros*100).toFixed(1) : 0;
    const fatPct = totalMacros ? ((dayFat*9)/totalMacros*100).toFixed(1) : 0;

    document.getElementById('day-totals').innerHTML = `
      <div><strong>Adjusted Daily Calorie Goal (base + rollerblading):</strong> ${adjustedGoal} kcal</div>
      <div><strong>Net Daily Calories (food - rollerblading):</strong> ${netCalories} kcal</div>
      <div>Macros: Protein ${proteinPct}%, Carbs ${carbsPct}%, Fat ${fatPct}%</div>

      <br>
      <div><strong>Macro Benchmarks:</strong></div>
      <table style="width:100%; font-size:14px; border-collapse: collapse;" border="1" cellpadding="5">
        <thead>
          <tr><th>Diet Type</th><th>Protein %</th><th>Carbs %</th><th>Fat %</th></tr>
        </thead>
        <tbody>
          <tr><td>High-Protein (fitness enthusiasts)</td><td>40%</td><td>40%</td><td>20%</td></tr>
          <tr><td>High-Carb (many vegans)</td><td>15%</td><td>65%</td><td>20%</td></tr>
          <tr><td>High-Fat (keto-style)</td><td>15%</td><td>10%</td><td>75%</td></tr>
        </tbody>
      </table>
    `;
  }

  // Weight tracking and chart
  let weightLog = [];
  function logWeight() {
    const weight = parseFloat(document.getElementById("dailyWeight").value);
    if(isNaN(weight) || weight <= 0) {
      alert("Please enter a valid weight.");
      return;
    }
    const today = new Date().toISOString().split("T")[0];
    const existing = weightLog.find(w => w.date === today);
    if(existing) {
      existing.weight = weight;
    } else {
      weightLog.push({date: today, weight});
      weightLog.sort((a,b) => new Date(a.date) - new Date(b.date));
    }
    renderWeightLog();
    renderWeightChart();
  }

  function renderWeightLog() {
    const container = document.getElementById("weightLog");
    container.innerHTML = "<strong>Date</strong> | <strong>Weight (lbs)</strong><br>";
    weightLog.forEach(w => {
      container.innerHTML += `${w.date} | ${w.weight}<br>`;
    });
  }

  function renderWeightChart() {
    const ctx = document.getElementById("weight-progress-chart").getContext("2d");
    if(window.weightChart) window.weightChart.destroy();

    window.weightChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: weightLog.map(w => w.date),
        datasets: [{
          label: "Weight (lbs)",
          data: weightLog.map(w => w.weight),
          borderColor: "blue",
          fill: false,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: { 
            display: true,
            title: { display: true, text: "Date" }
          },
          y: {
            display: true,
            title: { display: true, text: "Weight (lbs)" },
            beginAtZero: false
          }
        }
      }
    });
  }

  // NYC weather and electrolyte guidance
  const temperatureF = 89;
  const humidity = 65;
  document.getElementById("weather").innerText = `Union Square, NYC: ${temperatureF}°F — ${humidity}% humidity.`;
  if (temperatureF > 86) {
    document.getElementById("warning").innerText = 
      "🔥 It's hot! Rehydrate with LMNT (contains sodium, potassium, magnesium) or potassium-rich foods (bananas, avocado). Avoid SmartWater—too low in electrolytes. " +
      "Also avoid electrolyte supplements low in magnesium or with excessive additives.";
  }

  // Initialize on load
  window.onload = () => {
    renderMealSections();
    updateTotals();
  };
</script>

</body>
</html>
